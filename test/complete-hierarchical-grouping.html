<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåê ÂÆåÊï¥Â±ÇÊ¨°ÂåñÂàÜÁªÑÁÆóÊ≥ï</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .content {
            padding: 30px;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .demo-panel {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e2e8f0;
        }

        .panel-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .canvas {
            position: relative;
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            height: 500px;
            margin: 15px 0;
            overflow: hidden;
        }

        .element {
            position: absolute;
            border: 2px solid;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
        }

        .element:hover {
            transform: scale(1.05);
            z-index: 20;
        }

        .element-container { background-color: #4299e1; border-color: #3182ce; }
        .element-text { background-color: #ed8936; border-color: #dd6b20; }
        .element-button { background-color: #9f7aea; border-color: #805ad5; }
        .element-image { background-color: #48bb78; border-color: #38a169; }
        .element-normal { background-color: #38b2ac; border-color: #319795; }

        .group-boundary {
            position: absolute;
            border: 1px solid;
            background: transparent;
            border-radius: 4px;
            pointer-events: none;
            z-index: 5;
            opacity: 0.7;
        }

        /* ÁÆÄÂåñÁöÑÂ±ÇÊ¨°È¢úËâ≤ - Âè™ÊòæÁ§∫ÂÖ≥ÈîÆÂ±ÇÁ∫ß */
        .group-boundary.page {
            border-color: #1f2937;
            border-width: 3px;
            border-style: solid;
            background: rgba(31, 41, 55, 0.08);
            z-index: 1;
        }
        .group-boundary.section {
            border-color: #dc2626;
            border-width: 2px;
            border-style: dashed;
            background: rgba(220, 38, 38, 0.05);
            z-index: 2;
        }
        .group-boundary.article {
            border-color: #ea580c;
            border-width: 2px;
            border-style: dashed;
            background: rgba(234, 88, 12, 0.05);
            z-index: 3;
        }
        .group-boundary.header {
            border-color: #d97706;
            border-width: 1px;
            border-style: dotted;
            background: transparent;
            z-index: 4;
        }
        .group-boundary.nav {
            border-color: #ca8a04;
            border-width: 1px;
            border-style: dotted;
            background: transparent;
            z-index: 5;
        }
        .group-boundary.main {
            border-color: #65a30d;
            border-width: 2px;
            border-style: dashed;
            background: rgba(101, 163, 13, 0.05);
            z-index: 6;
        }
        .group-boundary.aside {
            border-color: #059669;
            border-width: 1px;
            border-style: dotted;
            background: transparent;
            z-index: 7;
        }
        .group-boundary.div {
            border-color: #0891b2;
            border-width: 1px;
            border-style: dotted;
            background: transparent;
            z-index: 8;
        }
        .group-boundary.component {
            border-color: #0284c7;
            border-width: 1px;
            border-style: dotted;
            background: transparent;
            z-index: 9;
        }

        .group-label {
            position: absolute;
            top: -10px;
            left: 4px;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.65em;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            opacity: 0.9;
        }

        /* Âè™‰∏∫ÈáçË¶ÅÂ±ÇÁ∫ßÊòæÁ§∫Ê†áÁ≠æ */
        .group-label.page { background: #1f2937; }
        .group-label.section { background: #dc2626; }
        .group-label.article { background: #ea580c; }
        .group-label.main { background: #65a30d; }

        /* ÂÖ∂‰ªñÂ±ÇÁ∫ßÁöÑÊ†áÁ≠æÊõ¥Â∞èÊõ¥ÈÄèÊòé */
        .group-label.header { background: #d97706; opacity: 0.7; font-size: 0.6em; }
        .group-label.nav { background: #ca8a04; opacity: 0.7; font-size: 0.6em; }
        .group-label.aside { background: #059669; opacity: 0.7; font-size: 0.6em; }
        .group-label.div { background: #0891b2; opacity: 0.6; font-size: 0.55em; }
        .group-label.component { background: #0284c7; opacity: 0.6; font-size: 0.55em; }

        .controls {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
        }

        .control-label {
            font-weight: 600;
            min-width: 120px;
        }

        .slider {
            flex: 1;
            max-width: 200px;
        }

        .value-display {
            min-width: 60px;
            font-weight: 600;
            color: #3b82f6;
        }

        .test-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        .test-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #3b82f6;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .test-btn:hover {
            background: #2563eb;
        }

        .test-btn.active {
            background: #1d4ed8;
        }

        .results-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            margin-top: 20px;
        }

        .group-tree {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            line-height: 1.6;
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            max-height: 500px;
            overflow-y: auto;
        }

        /* ‰∫§‰∫íÂºèÊ†ëËäÇÁÇπÊ†∑Âºè */
        .tree-node {
            margin: 2px 0;
            user-select: none;
        }

        .node-content {
            display: flex;
            align-items: center;
            padding: 6px 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .node-content:hover {
            background: #f3f4f6;
            transform: translateX(2px);
        }

        .node-toggle {
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            color: #6b7280;
            font-size: 10px;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .node-toggle:hover {
            background: #d1d5db;
        }

        .node-toggle.expanded {
            background: #3b82f6;
            color: white;
        }

        .node-toggle.leaf {
            background: transparent;
            cursor: default;
            color: #9ca3af;
        }

        .node-icon {
            margin-right: 6px;
            font-size: 14px;
        }

        .node-label {
            font-weight: 500;
            color: #1f2937;
            flex: 1;
            font-size: 13px;
        }

        .node-count {
            background: #e5e7eb;
            color: #6b7280;
            padding: 1px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
            margin-left: 6px;
        }

        .node-children {
            margin-left: 24px;
            border-left: 1px solid #e5e7eb;
            padding-left: 8px;
            display: none;
            animation: slideDown 0.2s ease;
        }

        .node-children.expanded {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ‰∏çÂêåÂ±ÇÁ∫ßÁöÑÊ†∑Âºè */
        .node-content.page { background: #f9fafb; border-left: 3px solid #1f2937; font-weight: 700; }
        .node-content.section { background: #fef2f2; border-left: 3px solid #dc2626; font-weight: 600; }
        .node-content.article { background: #fff7ed; border-left: 3px solid #ea580c; font-weight: 600; }
        .node-content.header { background: #fffbeb; border-left: 3px solid #d97706; font-weight: 600; }
        .node-content.nav { background: #fefce8; border-left: 3px solid #ca8a04; }
        .node-content.main { background: #f7fee7; border-left: 3px solid #65a30d; }
        .node-content.aside { background: #ecfdf5; border-left: 3px solid #059669; }
        .node-content.div { background: #f0f9ff; border-left: 3px solid #0891b2; }
        .node-content.component { background: #eff6ff; border-left: 3px solid #0284c7; }

        /* ÂéüÂßãÁªìÊûÑÊ†∑Âºè */
        .node-content.flat { background: #fafafa; border-left: 3px solid #9ca3af; color: #6b7280; }
        .node-content.element { background: #f8fafc; border-left: 2px solid #64748b; font-size: 0.85em; }

        /* Ê†ëÂΩ¢ÂØπÊØîÁΩëÊ†º */
        .tree-comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .tree-panel {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #e2e8f0;
        }

        .tree-panel-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 8px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        /* ÊéßÂà∂ÊåâÈíÆÊ†∑Âºè */
        .control-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: #3b82f6;
            color: white;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .control-btn:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .control-btn.secondary {
            background: #6b7280;
        }

        .control-btn.secondary:hover {
            background: #4b5563;
        }



        .stats-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }

        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: #3b82f6;
        }

        .stat-label {
            color: #6b7280;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .legend {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #e2e8f0;
        }

        .legend-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #1f2937;
        }

        .legend-items {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            border: 2px solid;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåê ÂÆåÊï¥Â±ÇÊ¨°ÂåñÂàÜÁªÑÁÆóÊ≥ï</h1>
            <p>ÂèÇËÄÉWebÊ†áÂáÜÔºåÁ°Æ‰øùÊâÄÊúâÂÖÉÁ¥†ÈÉΩË¢´ÂàÜÁªÑÔºå‰ªéÈ°µÈù¢Á∫ßÂà∞ÁªÑ‰ª∂Á∫ßÁöÑÂÆåÊï¥Â±ÇÊ¨°</p>
        </div>

        <div class="content">
            <!-- ÊéßÂà∂Èù¢Êùø -->
            <div class="controls">
                <h3 style="margin-bottom: 15px;">üß™ ÊµãËØïÁî®‰æãÈÄâÊã©</h3>

                <div class="test-buttons">
                    <button class="test-btn active" data-case="simple_card">üÉè ÁÆÄÂçïÂç°Áâá</button>
                    <button class="test-btn" data-case="basic_layout">üìÑ Âü∫Á°ÄÂ∏ÉÂ±Ä</button>
                    <button class="test-btn" data-case="form_example">üìù Ë°®ÂçïÁ§∫‰æã</button>
                    <button class="test-btn" data-case="navigation_bar">üß≠ ÂØºËà™Ê†è</button>
                    <button class="test-btn" data-case="dashboard_simple">üìä ÁÆÄÂçï‰ª™Ë°®Êùø</button>
                    <button class="test-btn" data-case="figma_cs_enterprise">üé® FigmaÂÆûÈôÖÊ°à‰æã</button>
                </div>

                <!-- Ê†°È™åÊåâÈíÆ -->
                <div style="margin-top: 15px;">
                    <button onclick="validateAllCases()" style="background: #10b981; color: white; padding: 8px 16px; border: none; border-radius: 4px; margin-right: 10px;">‚úÖ Ê†°È™åÊâÄÊúâÁî®‰æã</button>
                    <button onclick="testFunction()" style="background: #ef4444; color: white; padding: 8px 16px; border: none; border-radius: 4px; margin-right: 10px;">üîß Ê†°È™åÂΩìÂâçÁî®‰æã</button>
                        <button onclick="copyErrorsToClipboard()" style="background: #8b5cf6; color: white; padding: 8px 16px; border: none; border-radius: 4px;">üìã Â§çÂà∂ÈîôËØØ‰ø°ÊÅØ</button>
                </div>
            </div>

                    <!-- ÈîôËØØ‰ø°ÊÅØÊòæÁ§∫Âå∫Âüü -->
                    <div id="error-output" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; display: none;">
                    </div>





            <!-- ÁªüËÆ°‰ø°ÊÅØ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-elements">0</div>
                    <div class="stat-label">ÊÄªÂÖÉÁ¥†Êï∞</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-groups">0</div>
                    <div class="stat-label">ÂàÜÁªÑÊÄªÊï∞</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="coverage-rate">0%</div>
                    <div class="stat-label">Ë¶ÜÁõñÁéá</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="max-depth">0</div>
                    <div class="stat-label">ÊúÄÂ§ßÊ∑±Â∫¶</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avg-group-size">0</div>
                    <div class="stat-label">Âπ≥ÂùáÁªÑÂ§ßÂ∞è</div>
                </div>
            </div>

            <!-- ÊºîÁ§∫Âå∫Âüü -->
            <div class="demo-grid">
                <div class="demo-panel">
                    <div class="panel-title">üì• ÂéüÂßãÂÖÉÁ¥†Â∏ÉÂ±Ä</div>
                    <div class="canvas" id="original-canvas"></div>
                </div>
                
                <div class="demo-panel">
                    <div class="panel-title">üåê ÂÆåÊï¥Â±ÇÊ¨°ÂåñÂàÜÁªÑ</div>
                    <div class="canvas" id="grouped-canvas"></div>
                </div>
            </div>

            <!-- Ê†ëÂΩ¢ÁªìÊûÑÊéßÂà∂ -->
            <div class="results-panel">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>üå≥ ‰∫§‰∫íÂºèÊ†ëÂΩ¢ÁªìÊûÑÂØπÊØî</h3>
                    <div style="display: flex; gap: 10px;">
                        <button class="control-btn" id="expand-all-btn">üìÇ ÂÖ®ÈÉ®Â±ïÂºÄ</button>
                        <button class="control-btn" id="collapse-all-btn">üìÅ ÂÖ®ÈÉ®Êî∂Ëµ∑</button>
                        <button class="control-btn secondary" id="refresh-btn">üîÑ ÈáçÊñ∞ÂàÜÊûê</button>
                    </div>
                </div>

                <!-- Ê†ëÂΩ¢ÁªìÊûÑÂØπÊØî -->
                <div class="tree-comparison-grid">
                    <div class="tree-panel">
                        <div class="tree-panel-title">üî¥ ÂàÜÁªÑÂâçÁªìÊûÑ (ÊâÅÂπ≥)</div>
                        <div class="group-tree" id="original-tree"></div>
                    </div>

                    <div class="tree-panel">
                        <div class="tree-panel-title">üå≥ ÂàÜÁªÑÂêéÁªìÊûÑ (Â±ÇÊ¨°Âåñ)</div>
                        <div class="group-tree" id="grouped-tree"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="grouping-utils.js"></script>
    <script>
        // ÊµãËØïÊï∞ÊçÆÈõÜ - ‰ªéÁÆÄÂçïÂà∞Â§çÊùÇÁöÑÊ∏êËøõÂºè‰æãÂ≠ê
        const testCases = {
            // 1. üÉè ÁÆÄÂçïÂç°Áâá - ÊúÄÂü∫Á°ÄÁöÑÂàÜÁªÑÁ§∫‰æã
            simple_card: [
                { id: 'card_title', name: 'Áî®Êà∑‰ø°ÊÅØ', x: 20, y: 20, width: 200, height: 30, type: 'text' },
                { id: 'avatar', name: 'Â§¥ÂÉè', x: 30, y: 60, width: 60, height: 60, type: 'image' },
                { id: 'username', name: 'Âº†‰∏â', x: 100, y: 70, width: 100, height: 20, type: 'text' },
                { id: 'email', name: 'zhang@email.com', x: 100, y: 95, width: 120, height: 15, type: 'text' },
                { id: 'edit_btn', name: 'ÁºñËæë', x: 160, y: 130, width: 60, height: 25, type: 'button' }
            ],

            // 2. üìÑ Âü∫Á°ÄÂ∏ÉÂ±Ä - ÁÆÄÂçïÁöÑÈ°µÈù¢ÁªìÊûÑ
            basic_layout: [
                // Â§¥ÈÉ®Âå∫Âüü
                { id: 'logo', name: 'Logo', x: 20, y: 10, width: 80, height: 30, type: 'image' },
                { id: 'nav_home', name: 'È¶ñÈ°µ', x: 120, y: 15, width: 50, height: 20, type: 'button' },
                { id: 'nav_about', name: 'ÂÖ≥‰∫é', x: 180, y: 15, width: 50, height: 20, type: 'button' },

                // ‰∏ªË¶ÅÂÜÖÂÆπ
                { id: 'main_title', name: 'Ê¨¢Ëøé‰ΩøÁî®', x: 20, y: 60, width: 300, height: 40, type: 'text' },
                { id: 'content_text', name: 'ËøôÊòØ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü...', x: 20, y: 110, width: 280, height: 60, type: 'text' },
                { id: 'cta_button', name: 'ÂºÄÂßã‰ΩøÁî®', x: 20, y: 180, width: 100, height: 35, type: 'button' },

                // ‰æßËæπÊ†è
                { id: 'sidebar_title', name: 'Áõ∏ÂÖ≥ÈìæÊé•', x: 340, y: 60, width: 120, height: 25, type: 'text' },
                { id: 'link1', name: 'Â∏ÆÂä©ÊñáÊ°£', x: 350, y: 95, width: 80, height: 20, type: 'button' },
                { id: 'link2', name: 'ËÅîÁ≥ªÊàë‰ª¨', x: 350, y: 125, width: 80, height: 20, type: 'button' }
            ],

            // 3. üìù Ë°®ÂçïÁ§∫‰æã - Â±ïÁ§∫Ë°®ÂçïÂÖÉÁ¥†ÁöÑÂàÜÁªÑ
            form_example: [
                { id: 'form_title', name: 'Áî®Êà∑Ê≥®ÂÜå', x: 50, y: 20, width: 200, height: 30, type: 'text' },

                // Âü∫Êú¨‰ø°ÊÅØÁªÑ
                { id: 'basic_label', name: 'Âü∫Êú¨‰ø°ÊÅØ', x: 50, y: 70, width: 100, height: 20, type: 'text' },
                { id: 'name_label', name: 'ÂßìÂêç:', x: 60, y: 100, width: 50, height: 15, type: 'text' },
                { id: 'name_input', name: 'ÂßìÂêçËæìÂÖ•Ê°Ü', x: 120, y: 95, width: 150, height: 25, type: 'text' },
                { id: 'email_label', name: 'ÈÇÆÁÆ±:', x: 60, y: 130, width: 50, height: 15, type: 'text' },
                { id: 'email_input', name: 'ÈÇÆÁÆ±ËæìÂÖ•Ê°Ü', x: 120, y: 125, width: 150, height: 25, type: 'text' },

                // ÂØÜÁ†Å‰ø°ÊÅØÁªÑ
                { id: 'pwd_label', name: 'ÂØÜÁ†ÅËÆæÁΩÆ', x: 50, y: 170, width: 100, height: 20, type: 'text' },
                { id: 'password_label', name: 'ÂØÜÁ†Å:', x: 60, y: 200, width: 50, height: 15, type: 'text' },
                { id: 'password_input', name: 'ÂØÜÁ†ÅËæìÂÖ•Ê°Ü', x: 120, y: 195, width: 150, height: 25, type: 'text' },
                { id: 'confirm_label', name: 'Á°ÆËÆ§:', x: 60, y: 230, width: 50, height: 15, type: 'text' },
                { id: 'confirm_input', name: 'Á°ÆËÆ§ÂØÜÁ†ÅÊ°Ü', x: 120, y: 225, width: 150, height: 25, type: 'text' },

                // Êìç‰ΩúÊåâÈíÆÁªÑ
                { id: 'submit_btn', name: 'Ê≥®ÂÜå', x: 120, y: 270, width: 70, height: 30, type: 'button' },
                { id: 'cancel_btn', name: 'ÂèñÊ∂à', x: 200, y: 270, width: 70, height: 30, type: 'button' }
            ],

            // 4. üß≠ ÂØºËà™Ê†è - Ê∞¥Âπ≥Â∏ÉÂ±ÄÁöÑÂàÜÁªÑÁ§∫‰æã
            navigation_bar: [
                // Â∑¶‰æßÂìÅÁâåÂå∫
                { id: 'brand_logo', name: 'Logo', x: 20, y: 15, width: 40, height: 30, type: 'image' },
                { id: 'brand_name', name: 'ÊàëÁöÑÁΩëÁ´ô', x: 70, y: 20, width: 80, height: 20, type: 'text' },

                // ‰∏≠Èó¥ÂØºËà™ËèúÂçï
                { id: 'nav_home', name: 'È¶ñÈ°µ', x: 200, y: 20, width: 50, height: 20, type: 'button' },
                { id: 'nav_products', name: '‰∫ßÂìÅ', x: 260, y: 20, width: 50, height: 20, type: 'button' },
                { id: 'nav_services', name: 'ÊúçÂä°', x: 320, y: 20, width: 50, height: 20, type: 'button' },
                { id: 'nav_about', name: 'ÂÖ≥‰∫é', x: 380, y: 20, width: 50, height: 20, type: 'button' },

                // Âè≥‰æßÁî®Êà∑Âå∫
                { id: 'search_box', name: 'ÊêúÁ¥¢', x: 480, y: 18, width: 100, height: 24, type: 'text' },
                { id: 'login_btn', name: 'ÁôªÂΩï', x: 590, y: 18, width: 50, height: 24, type: 'button' },
                { id: 'signup_btn', name: 'Ê≥®ÂÜå', x: 650, y: 18, width: 50, height: 24, type: 'button' }
            ],

            // 5. üìä ÁÆÄÂçï‰ª™Ë°®Êùø - Â§öÂå∫ÂüüÂ∏ÉÂ±ÄÁ§∫‰æã
            dashboard_simple: [
                // È°∂ÈÉ®Ê†áÈ¢òÊ†è
                { id: 'dash_title', name: 'Êï∞ÊçÆ‰ª™Ë°®Êùø', x: 20, y: 20, width: 200, height: 30, type: 'text' },
                { id: 'refresh_btn', name: 'Âà∑Êñ∞', x: 500, y: 25, width: 60, height: 20, type: 'button' },

                // ÁªüËÆ°Âç°ÁâáÂå∫Âüü
                { id: 'card1_title', name: 'ÊÄªÁî®Êà∑', x: 20, y: 70, width: 120, height: 20, type: 'text' },
                { id: 'card1_value', name: '1,234', x: 20, y: 95, width: 120, height: 35, type: 'text' },
                { id: 'card1_trend', name: '+12%', x: 20, y: 135, width: 120, height: 15, type: 'text' },

                { id: 'card2_title', name: 'ÈîÄÂîÆÈ¢ù', x: 160, y: 70, width: 120, height: 20, type: 'text' },
                { id: 'card2_value', name: '¬•56,789', x: 160, y: 95, width: 120, height: 35, type: 'text' },
                { id: 'card2_trend', name: '+8%', x: 160, y: 135, width: 120, height: 15, type: 'text' },

                { id: 'card3_title', name: 'ËÆ¢ÂçïÊï∞', x: 300, y: 70, width: 120, height: 20, type: 'text' },
                { id: 'card3_value', name: '456', x: 300, y: 95, width: 120, height: 35, type: 'text' },
                { id: 'card3_trend', name: '+15%', x: 300, y: 135, width: 120, height: 15, type: 'text' },

                // ÂõæË°®Âå∫Âüü
                { id: 'chart_title', name: 'ÈîÄÂîÆË∂ãÂäø', x: 20, y: 180, width: 400, height: 25, type: 'text' },
                { id: 'chart_area', name: 'ÂõæË°®ÂÜÖÂÆπ', x: 20, y: 210, width: 400, height: 150, type: 'container' },

                // ÊúÄËøëÊ¥ªÂä®
                { id: 'activity_title', name: 'ÊúÄËøëÊ¥ªÂä®', x: 450, y: 70, width: 150, height: 25, type: 'text' },
                { id: 'activity1', name: 'Êñ∞Áî®Êà∑Ê≥®ÂÜå', x: 450, y: 105, width: 150, height: 20, type: 'text' },
                { id: 'activity2', name: 'ËÆ¢ÂçïÂÆåÊàê', x: 450, y: 130, width: 150, height: 20, type: 'text' },
                { id: 'activity3', name: 'ÊîØ‰ªòÊàêÂäü', x: 450, y: 155, width: 150, height: 20, type: 'text' }
            ],

            // 6. üé® FigmaÂÆûÈôÖÊ°à‰æã - CS‰ºÅ‰∏öÁâàÁïåÈù¢
            figma_cs_enterprise: []
        };

        // ÂÖ®Â±ÄÂèòÈáè
        let currentCase = 'simple_card';
        let currentGroups = [];

        // üé® FigmaÊï∞ÊçÆËΩ¨Êç¢ÂáΩÊï∞
        function convertFigmaToElements(figmaData) {
            console.log('üé® ÂºÄÂßãËΩ¨Êç¢FigmaÊï∞ÊçÆ...');
            const elements = [];

            function extractElements(node, parentBounds = null, depth = 0) {
                console.log(`${'  '.repeat(depth)}üîç Â§ÑÁêÜËäÇÁÇπ: ${node.name} (${node.type})`);

                // Â¶ÇÊûúËäÇÁÇπÊúâËæπÁïåÊ°ÜÔºåÂ∞ÜÂÖ∂‰Ωú‰∏∫ÂÖÉÁ¥†Ê∑ªÂä†
                if (node.boundingBox && node.boundingBox.width > 5 && node.boundingBox.height > 5) {
                    const element = {
                        id: node.id,
                        name: node.name || 'Unnamed',
                        x: Math.round(node.boundingBox.x),
                        y: Math.round(node.boundingBox.y),
                        width: Math.round(node.boundingBox.width),
                        height: Math.round(node.boundingBox.height),
                        type: determineFigmaElementType(node),
                        figmaType: node.type
                    };

                    elements.push(element);
                    console.log(`${'  '.repeat(depth)}üì¶ ÊèêÂèñÂÖÉÁ¥†: ${element.name} (${element.x},${element.y},${element.width}√ó${element.height}) [${element.type}]`);
                }

                // ÈÄíÂΩíÂ§ÑÁêÜÂ≠êËäÇÁÇπ
                if (node.children && node.children.length > 0) {
                    node.children.forEach(child => extractElements(child, node.boundingBox, depth + 1));
                }
            }

            // ‰ªénodesÊï∞ÁªÑ‰∏≠ÊèêÂèñÂÖÉÁ¥†
            if (figmaData.nodes && figmaData.nodes.length > 0) {
                figmaData.nodes.forEach(node => extractElements(node, null, 0));
            }

            console.log(`‚úÖ ËΩ¨Êç¢ÂÆåÊàêÔºåÂÖ±ÊèêÂèñ ${elements.length} ‰∏™ÂÖÉÁ¥†`);
            return elements;
        }

        function determineFigmaElementType(node) {
            const nodeType = node.type?.toLowerCase() || '';
            const nodeName = node.name?.toLowerCase() || '';

            // Ê†πÊçÆFigmaËäÇÁÇπÁ±ªÂûãÂà§Êñ≠
            if (nodeType.includes('text')) return 'text';
            if (nodeType.includes('image') || nodeType.includes('svg')) return 'image';
            if (nodeType.includes('frame') || nodeType.includes('group')) return 'container';
            if (nodeType.includes('instance') || nodeType.includes('component')) return 'button';
            if (nodeType.includes('rectangle') || nodeType.includes('ellipse')) return 'container';

            // Ê†πÊçÆËäÇÁÇπÂêçÁß∞Âà§Êñ≠
            if (nodeName.includes('button') || nodeName.includes('btn')) return 'button';
            if (nodeName.includes('text') || nodeName.includes('label')) return 'text';
            if (nodeName.includes('image') || nodeName.includes('icon') || nodeName.includes('logo')) return 'image';

            return 'normal';
        }

        // üé® FigmaÂéüÂßãÊï∞ÊçÆ
        const figmaRawData = {
            "metadata": {
                "name": "CS‰ºÅ‰∏öÁâà (Copy)",
                "lastModified": "2025-07-04T15:39:12Z"
            },
            "nodes": [
                {
                    "id": "16237:70560",
                    "name": "Frame 427319817",
                    "type": "FRAME",
                    "children": [
                        {
                            "id": "16237:70561",
                            "name": "ÈÇÄËØ∑ÊàêÂëòÊåâÈíÆ",
                            "type": "FRAME",
                            "boundingBox": {
                                "x": 10,
                                "y": 10,
                                "width": 100,
                                "height": 40
                            },
                            "children": [
                                {
                                    "id": "16237:70562",
                                    "name": "Frame 8",
                                    "type": "FRAME",
                                    "boundingBox": {
                                        "x": 15,
                                        "y": 15,
                                        "width": 90,
                                        "height": 30
                                    },
                                    "children": [
                                        {
                                            "id": "16237:70563",
                                            "name": "ÈÇÄËØ∑ÂõæÊ†á",
                                            "type": "INSTANCE",
                                            "boundingBox": {
                                                "x": 20,
                                                "y": 20,
                                                "width": 16,
                                                "height": 16
                                            }
                                        },
                                        {
                                            "id": "16237:70564",
                                            "name": "ÈÇÄËØ∑ÊàêÂëò",
                                            "type": "TEXT",
                                            "boundingBox": {
                                                "x": 40,
                                                "y": 22,
                                                "width": 60,
                                                "height": 16
                                            }
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "id": "16237:70565",
                            "name": "ÊâπÂØºÂÖ•ÊåâÈíÆ",
                            "type": "FRAME",
                            "boundingBox": {
                                "x": 120,
                                "y": 10,
                                "width": 120,
                                "height": 40
                            },
                            "children": [
                                {
                                    "id": "16237:70566",
                                    "name": "Frame 8",
                                    "type": "FRAME",
                                    "boundingBox": {
                                        "x": 125,
                                        "y": 15,
                                        "width": 110,
                                        "height": 30
                                    },
                                    "children": [
                                        {
                                            "id": "16237:70567",
                                            "name": "ÂØºÂÖ•ÂõæÊ†á",
                                            "type": "INSTANCE",
                                            "boundingBox": {
                                                "x": 130,
                                                "y": 20,
                                                "width": 16,
                                                "height": 16
                                            }
                                        },
                                        {
                                            "id": "16237:70568",
                                            "name": "ÊâπÂØºÂÖ•ÊàêÂëò",
                                            "type": "TEXT",
                                            "boundingBox": {
                                                "x": 150,
                                                "y": 22,
                                                "width": 80,
                                                "height": 16
                                            }
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "id": "16237:70569",
                            "name": "ÂØºÂá∫ÊåâÈíÆ",
                            "type": "FRAME",
                            "boundingBox": {
                                "x": 250,
                                "y": 10,
                                "width": 140,
                                "height": 40
                            },
                            "children": [
                                {
                                    "id": "16237:70570",
                                    "name": "Frame 8",
                                    "type": "FRAME",
                                    "boundingBox": {
                                        "x": 255,
                                        "y": 15,
                                        "width": 130,
                                        "height": 30
                                    },
                                    "children": [
                                        {
                                            "id": "16237:70571",
                                            "name": "ÂØºÂá∫ÂõæÊ†á",
                                            "type": "INSTANCE",
                                            "boundingBox": {
                                                "x": 260,
                                                "y": 20,
                                                "width": 16,
                                                "height": 16
                                            }
                                        },
                                        {
                                            "id": "16237:70572",
                                            "name": "ÂØºÂá∫ÊàêÂëòÂàóË°®",
                                            "type": "TEXT",
                                            "boundingBox": {
                                                "x": 280,
                                                "y": 22,
                                                "width": 100,
                                                "height": 16
                                            }
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "id": "16237:70573",
                            "name": "ÊèêÈÜíÊåâÈíÆ",
                            "type": "FRAME",
                            "boundingBox": {
                                "x": 400,
                                "y": 10,
                                "width": 120,
                                "height": 40
                            },
                            "children": [
                                {
                                    "id": "16237:70574",
                                    "name": "Frame 8",
                                    "type": "FRAME",
                                    "boundingBox": {
                                        "x": 405,
                                        "y": 15,
                                        "width": 110,
                                        "height": 30
                                    },
                                    "children": [
                                        {
                                            "id": "16237:70575",
                                            "name": "ÊèêÈÜíÂõæÊ†á",
                                            "type": "INSTANCE",
                                            "boundingBox": {
                                                "x": 410,
                                                "y": 20,
                                                "width": 16,
                                                "height": 16
                                            }
                                        },
                                        {
                                            "id": "16237:70576",
                                            "name": "ÊâπÈáèÊèêÈÜí",
                                            "type": "TEXT",
                                            "boundingBox": {
                                                "x": 430,
                                                "y": 22,
                                                "width": 80,
                                                "height": 16
                                            }
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        };









        // Ê∏≤ÊüìÂáΩÊï∞
        function renderCanvas(elements, canvasId) {
            const canvas = document.getElementById(canvasId);
            canvas.innerHTML = '';

            if (!elements || elements.length === 0) return;

            // ËÆ°ÁÆóÁº©ÊîæÊØî‰æã
            const maxX = Math.max(...elements.map(e => e.x + e.width));
            const maxY = Math.max(...elements.map(e => e.y + e.height));
            const scale = Math.min(canvas.clientWidth / maxX, canvas.clientHeight / maxY, 1) * 0.9;

            elements.forEach(element => {
                const div = document.createElement('div');
                div.className = `element element-${element.type}`;
                div.style.left = (element.x * scale) + 'px';
                div.style.top = (element.y * scale) + 'px';
                div.style.width = (element.width * scale) + 'px';
                div.style.height = (element.height * scale) + 'px';
                div.textContent = element.name.length > 8 ? element.name.substring(0, 8) + '...' : element.name;
                div.title = `${element.name}\n‰ΩçÁΩÆ: (${element.x}, ${element.y})\nÂ∞∫ÂØ∏: ${element.width} √ó ${element.height}`;
                canvas.appendChild(div);
            });
        }

        function renderGroupBoundaries(group, canvasId, scale) {
            const canvas = document.getElementById(canvasId);

            function renderGroup(currentGroup) {
                // Ê∏≤ÊüìÂΩìÂâçÂàÜÁªÑËæπÁïå
                const boundary = document.createElement('div');
                boundary.className = `group-boundary ${currentGroup.type}`;
                boundary.style.left = (currentGroup.bounds.x * scale) + 'px';
                boundary.style.top = (currentGroup.bounds.y * scale) + 'px';
                boundary.style.width = (currentGroup.bounds.width * scale) + 'px';
                boundary.style.height = (currentGroup.bounds.height * scale) + 'px';

                const label = document.createElement('div');
                label.className = `group-label ${currentGroup.type}`;
                label.textContent = currentGroup.name;
                boundary.appendChild(label);

                canvas.appendChild(boundary);

                // ÈÄíÂΩíÊ∏≤ÊüìÂ≠êÂàÜÁªÑ
                currentGroup.children.forEach(child => {
                    renderGroup(child);
                });
            }

            renderGroup(group);
        }

        function renderGroupedCanvas(elements, hierarchy) {
            renderCanvas(elements, 'grouped-canvas');

            // ËÆ°ÁÆóÁº©ÊîæÊØî‰æã
            const canvas = document.getElementById('grouped-canvas');
            const maxX = Math.max(...elements.map(e => e.x + e.width));
            const maxY = Math.max(...elements.map(e => e.y + e.height));
            const scale = Math.min(canvas.clientWidth / maxX, canvas.clientHeight / maxY, 1) * 0.9;

            renderGroupBoundaries(hierarchy, 'grouped-canvas', scale);
        }

        // Ê∏≤ÊüìÂéüÂßãÊâÅÂπ≥ÁªìÊûÑ
        function renderOriginalTree(elements) {
            const container = document.getElementById('original-tree');
            container.innerHTML = '';

            const rootNode = createTreeNode('flat', 'üìÑ ÂéüÂßãÂÖÉÁ¥†ÂàóË°®', elements.length, 'root');
            container.appendChild(rootNode);

            const childrenContainer = rootNode.querySelector('.node-children');
            elements.forEach((element, index) => {
                const elementNode = createTreeNode('element', `${getElementIcon(element.type)} ${element.name}`, 0, `element_${index}`, true);
                childrenContainer.appendChild(elementNode);
            });

            // ÈªòËÆ§Â±ïÂºÄÊ†πËäÇÁÇπ
            toggleNode('root');
        }

        // Ê∏≤ÊüìÂàÜÁªÑÂêéÁöÑÂ±ÇÊ¨°ÁªìÊûÑ
        function renderGroupTree(group) {
            const container = document.getElementById('grouped-tree');
            container.innerHTML = '';

            function buildInteractiveTree(currentGroup, parentContainer) {
                const hasChildren = currentGroup.children.length > 0;
                const nodeId = `group_${currentGroup.id}`;

                // Ê∑ªÂä†Â∏ÉÂ±ÄÊñπÂêëÂõæÊ†á
                const directionIcon = getDirectionIcon(currentGroup.direction);
                const treeNode = createTreeNode(
                    currentGroup.type,
                    `${directionIcon} ${currentGroup.name}`,
                    currentGroup.elements.length,
                    nodeId,
                    !hasChildren
                );

                parentContainer.appendChild(treeNode);

                if (hasChildren) {
                    const childrenContainer = treeNode.querySelector('.node-children');
                    currentGroup.children.forEach(child => {
                        buildInteractiveTree(child, childrenContainer);
                    });
                } else {
                    // Âè∂Â≠êËäÇÁÇπÊòæÁ§∫ÂÖÉÁ¥†ÂàóË°®
                    const childrenContainer = treeNode.querySelector('.node-children');
                    currentGroup.elements.forEach((element, index) => {
                        const elementNode = createTreeNode('element', `${getElementIcon(element.type)} ${element.name}`, 0, `${nodeId}_element_${index}`, true);
                        childrenContainer.appendChild(elementNode);
                    });
                }
            }

            buildInteractiveTree(group, container);

            // ÈªòËÆ§Â±ïÂºÄÊ†πËäÇÁÇπ
            toggleNode(`group_${group.id}`);
        }

        // ÂàõÂª∫‰∫§‰∫íÂºèÊ†ëËäÇÁÇπ
        function createTreeNode(type, label, count, nodeId, isLeaf = false) {
            const treeNode = document.createElement('div');
            treeNode.className = 'tree-node';
            treeNode.innerHTML = `
                <div class="node-content ${type}">
                    <div class="node-toggle ${isLeaf ? 'leaf' : ''}" data-node-id="${nodeId}">
                        ${isLeaf ? '‚Ä¢' : '+'}
                    </div>
                    <span class="node-label">${label}</span>
                    ${count > 0 ? `<span class="node-count">${count}</span>` : ''}
                </div>
                <div class="node-children" id="children_${nodeId}"></div>
            `;

            // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
            if (!isLeaf) {
                const toggle = treeNode.querySelector('.node-toggle');
                toggle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleNode(nodeId);
                });
            }

            return treeNode;
        }

        // ÂàáÊç¢ËäÇÁÇπÂ±ïÂºÄ/Êî∂Ëµ∑Áä∂ÊÄÅ
        function toggleNode(nodeId) {
            const toggle = document.querySelector(`[data-node-id="${nodeId}"]`);
            const children = document.getElementById(`children_${nodeId}`);

            if (!toggle || !children) return;

            const isExpanded = children.classList.contains('expanded');

            if (isExpanded) {
                children.classList.remove('expanded');
                toggle.textContent = '+';
                toggle.classList.remove('expanded');
            } else {
                children.classList.add('expanded');
                toggle.textContent = '‚àí';
                toggle.classList.add('expanded');
            }
        }

        // Â±ïÂºÄÊâÄÊúâËäÇÁÇπ
        function expandAllNodes() {
            document.querySelectorAll('.node-toggle:not(.leaf)').forEach(toggle => {
                const nodeId = toggle.dataset.nodeId;
                const children = document.getElementById(`children_${nodeId}`);
                if (children && !children.classList.contains('expanded')) {
                    toggleNode(nodeId);
                }
            });
        }

        // Êî∂Ëµ∑ÊâÄÊúâËäÇÁÇπ
        function collapseAllNodes() {
            document.querySelectorAll('.node-toggle:not(.leaf)').forEach(toggle => {
                const nodeId = toggle.dataset.nodeId;
                const children = document.getElementById(`children_${nodeId}`);
                if (children && children.classList.contains('expanded')) {
                    toggleNode(nodeId);
                }
            });
        }

        // Ëé∑ÂèñÂàÜÁªÑÂõæÊ†á
        function getGroupIcon(type) {
            const icons = {
                page: 'üåê',
                section: 'üî¥',
                article: 'üü†',
                header: 'üü°',
                nav: 'üü§',
                main: 'üü¢',
                aside: 'üîµ',
                div: 'üî∑',
                component: 'üîπ'
            };
            return icons[type] || 'üì¶';
        }

        // Ëé∑ÂèñÂÖÉÁ¥†ÂõæÊ†á
        function getElementIcon(type) {
            const icons = {
                container: 'üì¶',
                text: 'üìù',
                button: 'üîò',
                image: 'üñºÔ∏è',
                normal: '‚ö™'
            };
            return icons[type] || '‚ö™';
        }

        // üéØ Ëé∑ÂèñÂ∏ÉÂ±ÄÊñπÂêëÂõæÊ†á
        function getDirectionIcon(direction) {
            const icons = {
                'HORIZONTAL': '‚ÜîÔ∏è',  // Ê®™ÂêëÂ∏ÉÂ±Ä
                'VERTICAL': '‚ÜïÔ∏è',    // Á∫µÂêëÂ∏ÉÂ±Ä
                'NONE': '‚ö™'         // Âçï‰∏™ÂÖÉÁ¥†
            };
            return icons[direction] || '‚ÜîÔ∏è'; // ÈªòËÆ§Ê®™Âêë
        }

        function updateStats(elements, hierarchy) {
            const totalGroups = countTotalGroups(hierarchy);
            const maxDepth = getMaxDepth(hierarchy);
            const avgGroupSize = calculateAverageGroupSize(hierarchy);
            const coverageRate = 100; // ÊâÄÊúâÂÖÉÁ¥†ÈÉΩË¢´Ë¶ÜÁõñ

            document.getElementById('total-elements').textContent = elements.length;
            document.getElementById('total-groups').textContent = totalGroups;
            document.getElementById('coverage-rate').textContent = coverageRate + '%';
            document.getElementById('max-depth').textContent = maxDepth;
            document.getElementById('avg-group-size').textContent = avgGroupSize.toFixed(1);
        }

        function countTotalGroups(group) {
            let count = 1; // ÂΩìÂâçÂàÜÁªÑ
            group.children.forEach(child => {
                count += countTotalGroups(child);
            });
            return count;
        }

        function getMaxDepth(group) {
            if (group.children.length === 0) return group.level;

            let maxChildDepth = 0;
            group.children.forEach(child => {
                maxChildDepth = Math.max(maxChildDepth, getMaxDepth(child));
            });

            return maxChildDepth;
        }

        function calculateAverageGroupSize(group) {
            const allGroups = [];

            function collectGroups(currentGroup) {
                allGroups.push(currentGroup);
                currentGroup.children.forEach(child => {
                    collectGroups(child);
                });
            }

            collectGroups(group);

            const totalElements = allGroups.reduce((sum, g) => sum + g.elements.length, 0);
            return totalElements / allGroups.length;
        }

        function runGrouping() {
            console.log('üîÑ ÂºÄÂßãÊâßË°åÊó†ÈòàÂÄºÂàÜÁªÑÁÆóÊ≥ï...');

            const elements = testCases[currentCase];
            console.log('üìä ÂÖÉÁ¥†Êï∞ÊçÆ:', elements);

            if (!elements || elements.length === 0) {
                console.error('‚ùå Ê≤°ÊúâÊâæÂà∞ÊµãËØïÊï∞ÊçÆ');
                return;
            }

            const hierarchy = performCompleteHierarchicalGrouping(elements);
            console.log('üèóÔ∏è ÂàÜÁªÑÁªìÊûú:', hierarchy);

            currentGroups = [hierarchy];

            try {
                renderCanvas(elements, 'original-canvas');
                console.log('‚úÖ ÂéüÂßãÁîªÂ∏ÉÊ∏≤ÊüìÂÆåÊàê');

                renderGroupedCanvas(elements, hierarchy);
                console.log('‚úÖ ÂàÜÁªÑÁîªÂ∏ÉÊ∏≤ÊüìÂÆåÊàê');

                renderOriginalTree(elements);
                console.log('‚úÖ ÂéüÂßãÊ†ëÂΩ¢ÁªìÊûÑÊ∏≤ÊüìÂÆåÊàê');

                renderGroupTree(hierarchy);
                console.log('‚úÖ ÂàÜÁªÑÊ†ëÂΩ¢ÁªìÊûÑÊ∏≤ÊüìÂÆåÊàê');

                updateStats(elements, hierarchy);
                console.log('‚úÖ ÁªüËÆ°‰ø°ÊÅØÊõ¥Êñ∞ÂÆåÊàê');

            } catch (error) {
                console.error('‚ùå Ê∏≤ÊüìÈîôËØØ:', error);
            }
        }

        // ‰∫ã‰ª∂ÁõëÂê¨Âô®
        function initEventListeners() {
            // ÊµãËØïÁî®‰æãÊåâÈíÆ
            document.querySelectorAll('.test-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.test-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentCase = btn.dataset.case;
                    runGrouping();
                });
            });

            // Ê†ëÂΩ¢ÊéßÂà∂ÊåâÈíÆ
            document.getElementById('expand-all-btn').addEventListener('click', expandAllNodes);
            document.getElementById('collapse-all-btn').addEventListener('click', collapseAllNodes);
            document.getElementById('refresh-btn').addEventListener('click', runGrouping);
        }

        // ÂàùÂßãÂåñ
        function init() {
            console.log('üöÄ ÂºÄÂßãÂàùÂßãÂåñ...');

            // üé® ËΩ¨Êç¢FigmaÊï∞ÊçÆ
            console.log('üé® ËΩ¨Êç¢FigmaÊï∞ÊçÆ...');
            testCases.figma_cs_enterprise = convertFigmaToElements(figmaRawData);
            console.log('‚úÖ FigmaÊï∞ÊçÆËΩ¨Êç¢ÂÆåÊàêÔºåÂÖÉÁ¥†Êï∞Èáè:', testCases.figma_cs_enterprise.length);

            console.log('ÂΩìÂâçÊµãËØïÁî®‰æã:', currentCase);
            console.log('ÊµãËØïÊï∞ÊçÆ:', testCases[currentCase]);

            // ÂÖàÊµãËØïÂü∫Êú¨ÁöÑDOMÊìç‰Ωú
            const originalCanvas = document.getElementById('original-canvas');
            const groupedCanvas = document.getElementById('grouped-canvas');

            if (!originalCanvas || !groupedCanvas) {
                console.error('‚ùå Êâæ‰∏çÂà∞ÁîªÂ∏ÉÂÖÉÁ¥†');
                return;
            }

            console.log('‚úÖ ÁîªÂ∏ÉÂÖÉÁ¥†ÊâæÂà∞');

            try {
                initEventListeners();
                console.log('‚úÖ ‰∫ã‰ª∂ÁõëÂê¨Âô®ÂàùÂßãÂåñÂÆåÊàê');

                // Âª∂ËøüÊâßË°åÂàÜÁªÑÁÆóÊ≥ïÔºåÁ°Æ‰øùDOMÂÆåÂÖ®Âä†ËΩΩ
                setTimeout(() => {
                    runGrouping();
                    console.log('‚úÖ ÂàÜÁªÑÁÆóÊ≥ïÊâßË°åÂÆåÊàê');
                }, 100);

                console.log('üåê ÂÆåÊï¥Â±ÇÊ¨°ÂåñÂàÜÁªÑÁÆóÊ≥ïÂ∑≤Âä†ËΩΩ');
            } catch (error) {
                console.error('‚ùå ÂàùÂßãÂåñÈîôËØØ:', error);
                console.error('ÈîôËØØÂ†ÜÊ†à:', error.stack);
            }
        }

        // ÂàÜÁªÑÊ≠£Á°ÆÊÄßÊ†°È™åÂáΩÊï∞
        function validateGrouping(elements, hierarchy) {
            console.log('\nüîç ÂºÄÂßãÊ†°È™åÂàÜÁªÑÊ≠£Á°ÆÊÄß...');

            const issues = [];
            const warnings = [];

            // 1. Ê£ÄÊü•ÊâÄÊúâÂÖÉÁ¥†ÊòØÂê¶ÈÉΩË¢´ÂåÖÂê´
            const allElementsInHierarchy = getAllElementsFromHierarchy(hierarchy);
            const originalElementIds = new Set(elements.map(e => e.id));
            const hierarchyElementIds = new Set(allElementsInHierarchy.map(e => e.id));

            for (const id of originalElementIds) {
                if (!hierarchyElementIds.has(id)) {
                    issues.push(`‚ùå ÂÖÉÁ¥† ${id} Âú®ÂàÜÁªÑ‰∏≠‰∏¢Â§±`);
                }
            }

            // 2. Ê£ÄÊü•Á©∫Èó¥ÂåÖÂê´ÂÖ≥Á≥ªÊòØÂê¶Ê≠£Á°Æ
            function validateSpatialRelations(group) {
                if (group.children.length === 0) return;

                for (const child of group.children) {
                    // Ê£ÄÊü•Â≠êÂÖÉÁ¥†ÊòØÂê¶ÁúüÁöÑÂú®Áà∂ÂÖÉÁ¥†ÂÜÖÈÉ®
                    if (child.elements && child.elements.length > 0) {
                        const childBounds = child.bounds;
                        const parentBounds = group.bounds;

                        if (childBounds.x < parentBounds.x ||
                            childBounds.y < parentBounds.y ||
                            childBounds.x + childBounds.width > parentBounds.x + parentBounds.width ||
                            childBounds.y + childBounds.height > parentBounds.y + parentBounds.height) {
                            warnings.push(`‚ö†Ô∏è Â≠êÂàÜÁªÑ ${child.name} Ë∂ÖÂá∫Áà∂ÂàÜÁªÑ ${group.name} ËæπÁïå`);
                        }
                    }

                    // ÈÄíÂΩíÊ£ÄÊü•Â≠êÂàÜÁªÑ
                    validateSpatialRelations(child);
                }
            }

            validateSpatialRelations(hierarchy);

            // 3. Ê£ÄÊü•ÂàÜÁªÑÁöÑÂêàÁêÜÊÄß
            function validateGroupLogic(group) {
                if (group.children.length === 0) return;

                // Ê£ÄÊü•ÊòØÂê¶ÊúâÂçïÂ≠êËäÇÁÇπÂàÜÁªÑÔºàÂ∫îËØ•Â∑≤ÁªèË¢´‰ºòÂåñÊéâ‰∫ÜÔºâ
                if (group.children.length === 1) {
                    warnings.push(`‚ö†Ô∏è ÂàÜÁªÑ ${group.name} Âè™Êúâ‰∏Ä‰∏™Â≠êÂàÜÁªÑÔºåÂèØËÉΩÈúÄË¶ÅËøõ‰∏ÄÊ≠•‰ºòÂåñ`);
                }

                // Ê£ÄÊü•ÂàÜÁªÑÊñπÂêëÊòØÂê¶ÂêàÁêÜ
                if (group.children.length > 1) {
                    const direction = group.direction;
                    const childPositions = group.children.map(child => ({
                        x: child.bounds.x,
                        y: child.bounds.y,
                        width: child.bounds.width,
                        height: child.bounds.height
                    }));

                    if (direction === 'HORIZONTAL') {
                        // Ê∞¥Âπ≥ÂàÜÁªÑÔºöÊ£ÄÊü•ÊòØÂê¶ÁúüÁöÑÊòØÊ∞¥Âπ≥ÊéíÂàó
                        const avgY = childPositions.reduce((sum, pos) => sum + pos.y, 0) / childPositions.length;
                        const yVariance = childPositions.reduce((sum, pos) => sum + Math.pow(pos.y - avgY, 2), 0) / childPositions.length;

                        if (yVariance > 1000) { // ÈòàÂÄºÂèØË∞ÉÊï¥
                            warnings.push(`‚ö†Ô∏è ÂàÜÁªÑ ${group.name} Ê†áËÆ∞‰∏∫Ê∞¥Âπ≥Â∏ÉÂ±ÄÔºå‰ΩÜÂ≠êÂÖÉÁ¥†ÂûÇÁõ¥‰ΩçÁΩÆÂ∑ÆÂºÇËæÉÂ§ß`);
                        }
                    } else if (direction === 'VERTICAL') {
                        // ÂûÇÁõ¥ÂàÜÁªÑÔºöÊ£ÄÊü•ÊòØÂê¶ÁúüÁöÑÊòØÂûÇÁõ¥ÊéíÂàó
                        const avgX = childPositions.reduce((sum, pos) => sum + pos.x, 0) / childPositions.length;
                        const xVariance = childPositions.reduce((sum, pos) => sum + Math.pow(pos.x - avgX, 2), 0) / childPositions.length;

                        if (xVariance > 1000) { // ÈòàÂÄºÂèØË∞ÉÊï¥
                            warnings.push(`‚ö†Ô∏è ÂàÜÁªÑ ${group.name} Ê†áËÆ∞‰∏∫ÂûÇÁõ¥Â∏ÉÂ±ÄÔºå‰ΩÜÂ≠êÂÖÉÁ¥†Ê∞¥Âπ≥‰ΩçÁΩÆÂ∑ÆÂºÇËæÉÂ§ß`);
                        }
                    }
                }

                // ÈÄíÂΩíÊ£ÄÊü•Â≠êÂàÜÁªÑ
                group.children.forEach(validateGroupLogic);
            }

            validateGroupLogic(hierarchy);

            // 4. ËæìÂá∫Ê†°È™åÁªìÊûú
            console.log('\nüìä ÂàÜÁªÑÊ†°È™åÁªìÊûú:');
            console.log('================');

            if (issues.length === 0 && warnings.length === 0) {
                console.log('‚úÖ ÂàÜÁªÑÂÆåÂÖ®Ê≠£Á°ÆÔºÅÊ≤°ÊúâÂèëÁé∞ÈóÆÈ¢ò„ÄÇ');
            } else {
                if (issues.length > 0) {
                    console.log('‚ùå ÂèëÁé∞‰∏•ÈáçÈóÆÈ¢ò:');
                    issues.forEach(issue => console.log('  ' + issue));
                }

                if (warnings.length > 0) {
                    console.log('‚ö†Ô∏è ÂèëÁé∞ÊΩúÂú®ÈóÆÈ¢ò:');
                    warnings.forEach(warning => console.log('  ' + warning));
                }
            }

            // 5. ËæìÂá∫ÂàÜÁªÑÁªüËÆ°
            const stats = {
                totalElements: elements.length,
                totalGroups: countTotalGroups(hierarchy),
                maxDepth: getMaxDepth(hierarchy),
                avgGroupSize: calculateAverageGroupSize(hierarchy)
            };

            console.log('\nüìà ÂàÜÁªÑÁªüËÆ°:');
            console.log(`  ÊÄªÂÖÉÁ¥†Êï∞: ${stats.totalElements}`);
            console.log(`  ÊÄªÂàÜÁªÑÊï∞: ${stats.totalGroups}`);
            console.log(`  ÊúÄÂ§ßÊ∑±Â∫¶: ${stats.maxDepth}`);
            console.log(`  Âπ≥ÂùáÂàÜÁªÑÂ§ßÂ∞è: ${stats.avgGroupSize.toFixed(1)}`);

            return {
                isValid: issues.length === 0,
                issues,
                warnings,
                stats
            };
        }

        // ‰ªéÂ±ÇÊ¨°ÁªìÊûÑ‰∏≠Ëé∑ÂèñÊâÄÊúâÂÖÉÁ¥†
        function getAllElementsFromHierarchy(group) {
            let allElements = [...group.elements];
            for (const child of group.children) {
                allElements = allElements.concat(getAllElementsFromHierarchy(child));
            }
            return allElements;
        }

        // üéØ Ê†°È™åÂΩìÂâçÁî®‰æãÁöÑÂàÜÁªÑÈÄªËæë
        function testFunction() {
            console.log(`\nüîç ===== ËØ¶ÁªÜÊ†°È™åÁî®‰æã: ${currentCase} =====`);
            validateSingleCaseDetailed(currentCase);
        }

        // üéØ ËØ¶ÁªÜÊ†°È™åÂçï‰∏™Áî®‰æã
        function validateSingleCaseDetailed(caseId) {
            const elements = testCases[caseId];
            if (!elements || elements.length === 0) {
                console.error(`‚ùå ${caseId}: Ê≤°ÊúâÊµãËØïÊï∞ÊçÆ`);
                return false;
            }

            console.log(`\nüìã ËØ¶ÁªÜÂàÜÊûêÁî®‰æã: ${caseId}`);
            console.log(`ÂÖÉÁ¥†ÂàóË°®: ${elements.map(e => `${e.name}(${e.x},${e.y},${e.width}√ó${e.height})`).join(', ')}`);

            try {
                // ÊâßË°åÂàÜÁªÑÁÆóÊ≥ïÂπ∂Ëé∑ÂèñËØ¶ÁªÜËøáÁ®ã
                const hierarchy = performCompleteHierarchicalGrouping(elements);
                const actualGroups = extractGroupsFromHierarchy(hierarchy);
                const expectedGroups = getExpectedGroups(caseId);

                console.log(`\nüìä ÂàÜÁªÑÂØπÊØî:`);
                console.log(`È¢ÑÊúüÂàÜÁªÑ (${expectedGroups.length} ÁªÑ):`);
                expectedGroups.forEach((group, index) => {
                    console.log(`  ${index + 1}. [${group.join(', ')}]`);
                });

                console.log(`ÂÆûÈôÖÂàÜÁªÑ (${actualGroups.length} ÁªÑ):`);
                actualGroups.forEach((group, index) => {
                    console.log(`  ${index + 1}. [${group.join(', ')}]`);
                });

                return compareGroupingResults(caseId, actualGroups, expectedGroups);

            } catch (error) {
                console.error(`‚ùå ${caseId}: ÂàÜÁªÑÁÆóÊ≥ïÊâßË°åÈîôËØØ:`, error);
                return false;
            }
        }

        // ÂÖ®Â±ÄÈîôËØØ‰ø°ÊÅØÊî∂ÈõÜ
        let globalErrorMessages = [];

        // üéØ Ê†°È™åÊâÄÊúâÁî®‰æãÁöÑÂàÜÁªÑÈÄªËæë
        function validateAllCases() {
            console.log(`\nüîç ===== Ê†°È™åÊâÄÊúâÂàÜÁªÑÈÄªËæë =====`);

            // Ê∏ÖÁ©∫‰πãÂâçÁöÑÈîôËØØ‰ø°ÊÅØ
            globalErrorMessages = [];

            const cases = ['simple_card', 'basic_layout', 'form_example', 'navigation_bar', 'dashboard_simple', 'figma_cs_enterprise'];
            let passedCount = 0;

            cases.forEach(caseId => {
                const passed = validateSingleCase(caseId);
                if (passed) passedCount++;
            });

            const summary = `üìä ÊÄª‰ΩìÊ†°È™åÁªìÊûú: ${passedCount}/${cases.length} ÈÄöËøá`;
            console.log(`\n${summary}`);
            globalErrorMessages.push(summary);

            if (passedCount === cases.length) {
                const successMsg = 'üéâ ÊâÄÊúâÁî®‰æãÊ†°È™åÈÄöËøáÔºÅ';
                console.log(successMsg);
                globalErrorMessages.push(successMsg);
            } else {
                const warningMsg = '‚ö†Ô∏è ÈÉ®ÂàÜÁî®‰æãÈúÄË¶ÅÊîπËøõ';
                console.log(warningMsg);
                globalErrorMessages.push(warningMsg);
            }

            // ÊòæÁ§∫ÈîôËØØ‰ø°ÊÅØÂà∞È°µÈù¢
            displayErrorMessages();
        }

        // üéØ Ê†°È™åÂçï‰∏™Áî®‰æã
        function validateSingleCase(caseId) {
            const elements = testCases[caseId];
            if (!elements || elements.length === 0) {
                const errorMsg = `‚ùå ${caseId}: Ê≤°ÊúâÊµãËØïÊï∞ÊçÆ`;
                console.error(errorMsg);
                globalErrorMessages.push(errorMsg);
                return false;
            }

            const caseHeader = `\nüìã Ê†°È™åÁî®‰æã: ${caseId}`;
            console.log(caseHeader);
            globalErrorMessages.push(caseHeader);

            const elementList = `ÂÖÉÁ¥†ÂàóË°®: ${elements.map(e => e.name).join(', ')}`;
            console.log(elementList);
            globalErrorMessages.push(elementList);

            try {
                const hierarchy = performCompleteHierarchicalGrouping(elements);
                const actualGroups = extractGroupsFromHierarchy(hierarchy);
                const expectedGroups = getExpectedGroups(caseId);

                return compareGroupingResults(caseId, actualGroups, expectedGroups);

            } catch (error) {
                const errorMsg = `‚ùå ${caseId}: ÂàÜÁªÑÁÆóÊ≥ïÊâßË°åÈîôËØØ: ${error.message}`;
                console.error(errorMsg);
                globalErrorMessages.push(errorMsg);
                return false;
            }
        }

        // üéØ Ëé∑ÂèñÈ¢ÑÊúüÁöÑÂàÜÁªÑÁªìÊûú
        function getExpectedGroups(caseId) {
            const expected = {
                'simple_card': [
                    ['Áî®Êà∑‰ø°ÊÅØ'],
                    ['Â§¥ÂÉè', 'Âº†‰∏â', 'zhang@email.com'],
                    ['ÁºñËæëÊåâÈíÆ']
                ],
                'basic_layout': [
                    ['Logo', 'È¶ñÈ°µ', 'ÂÖ≥‰∫é'],
                    ['Ê¨¢Ëøé‰ΩøÁî®', 'ËøôÊòØ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü...'],
                    ['Áõ∏ÂÖ≥ÈìæÊé•', 'Â∏ÆÂä©ÊñáÊ°£', 'ËÅîÁ≥ªÊàë‰ª¨'],
                    ['ÂºÄÂßã‰ΩøÁî®']
                ],
                'form_example': [
                    ['Âü∫Êú¨‰ø°ÊÅØ'],
                    ['ÂßìÂêç:', 'ÂßìÂêçËæìÂÖ•Ê°Ü', 'ÈÇÆÁÆ±:', 'ÈÇÆÁÆ±ËæìÂÖ•Ê°Ü'],
                    ['ÂØÜÁ†ÅËÆæÁΩÆ'],
                    ['ÂØÜÁ†Å:', 'ÂØÜÁ†ÅËæìÂÖ•Ê°Ü', 'Á°ÆËÆ§ÂØÜÁ†Å:', 'Á°ÆËÆ§ÂØÜÁ†ÅËæìÂÖ•Ê°Ü'],
                    ['Ê≥®ÂÜå', 'ÂèñÊ∂à']
                ],
                'navigation_bar': [
                    ['Logo', 'ÊàëÁöÑÁΩëÁ´ô'],
                    ['È¶ñÈ°µ', '‰∫ßÂìÅ', 'ÊúçÂä°', 'ÂÖ≥‰∫é'],
                    ['ÊêúÁ¥¢Ê°Ü', 'ÁôªÂΩï', 'Ê≥®ÂÜå']
                ],
                'dashboard_simple': [
                    ['Êï∞ÊçÆ‰ª™Ë°®Êùø', 'Âà∑Êñ∞'],
                    ['ÊÄªÁî®Êà∑', '1,234', '+12%'],
                    ['ÈîÄÂîÆÈ¢ù', '¬•56,789', '+8%'],
                    ['ËÆ¢ÂçïÊï∞', '456', '+15%'],
                    ['ÊúÄËøëÊ¥ªÂä®', 'Êñ∞Áî®Êà∑Ê≥®ÂÜå', 'ËÆ¢ÂçïÂÆåÊàê', 'ÊîØ‰ªòÊàêÂäü'],
                    ['ÈîÄÂîÆË∂ãÂäø', 'ÂõæË°®ÂÜÖÂÆπ']
                ],
                'figma_cs_enterprise': [
                    ['cs_ic_common_invite_user_ÈÇÄËØ∑ÊàêÂëò', 'ÈÇÄËØ∑ÊàêÂëò'],
                    ['cs_ic_common_import_doc_ÂØºÂÖ•ÊñáÊ°£', 'ÊâπÂØºÂÖ•ÊàêÂëò'],
                    ['cs_ic_common_extract-ÊèêÂèñÈ°µÈù¢', 'ÂØºÂá∫ÊàêÂëòÂàóË°®'],
                    ['cs_ic_common_subscribe_ËÆ¢ÈòÖ', 'ÊâπÈáèÊèêÈÜí']
                ]
            };

            return expected[caseId] || [];
        }

        // üéØ ‰ªéÂ±ÇÊ¨°ÁªìÊûÑ‰∏≠ÊèêÂèñÂàÜÁªÑÔºà‰øÆÂ§çÁâàÊú¨Ôºâ
        function extractGroupsFromHierarchy(hierarchy) {
            const groups = [];

            function extractGroups(node) {
                console.log(`üîç ÊèêÂèñÂàÜÁªÑ - ËäÇÁÇπ: ${node.name}, ÂÖÉÁ¥†Êï∞: ${node.elements?.length || 0}, Â≠êËäÇÁÇπÊï∞: ${node.children?.length || 0}`);

                // Â¶ÇÊûúÊúâÂ≠êËäÇÁÇπÔºå‰ºòÂÖàÂ§ÑÁêÜÂ≠êËäÇÁÇπ
                if (node.children && node.children.length > 0) {
                    console.log(`  üìÇ Â§ÑÁêÜ ${node.children.length} ‰∏™Â≠êËäÇÁÇπ`);
                    node.children.forEach(child => extractGroups(child));
                } else if (node.elements && node.elements.length > 0) {
                    // Âè™ÊúâÂú®Ê≤°ÊúâÂ≠êËäÇÁÇπÊó∂ÔºåÊâçÂ∞ÜÂÖÉÁ¥†‰Ωú‰∏∫Âè∂Â≠êÂàÜÁªÑ
                    const elementNames = node.elements.map(e => e.name);
                    console.log(`  üì¶ Âè∂Â≠êÂàÜÁªÑ: [${elementNames.join(', ')}]`);
                    groups.push(elementNames);
                }
            }

            extractGroups(hierarchy);
            console.log(`üéØ ÊúÄÁªàÊèêÂèñÂà∞ ${groups.length} ‰∏™ÂàÜÁªÑ: ${groups.map(g => `[${g.join(', ')}]`).join(', ')}`);
            return groups;
        }

        // üéØ ÊØîËæÉÂàÜÁªÑÁªìÊûú
        function compareGroupingResults(caseId, actualGroups, expectedGroups) {
            const comparisonHeader = `\nüîç ${caseId} - ÂàÜÁªÑÂØπÊØî:`;
            console.log(comparisonHeader);
            globalErrorMessages.push(comparisonHeader);

            const expectedInfo = `È¢ÑÊúüÂàÜÁªÑ (${expectedGroups.length} ÁªÑ): ${JSON.stringify(expectedGroups)}`;
            const actualInfo = `ÂÆûÈôÖÂàÜÁªÑ (${actualGroups.length} ÁªÑ): ${JSON.stringify(actualGroups)}`;
            console.log(expectedInfo);
            console.log(actualInfo);
            globalErrorMessages.push(expectedInfo);
            globalErrorMessages.push(actualInfo);

            let passed = true;
            const issues = [];

            // Ê£ÄÊü•ÂàÜÁªÑÊï∞Èáè
            if (actualGroups.length !== expectedGroups.length) {
                issues.push(`ÂàÜÁªÑÊï∞Èáè‰∏çÂåπÈÖç: È¢ÑÊúü ${expectedGroups.length}, ÂÆûÈôÖ ${actualGroups.length}`);
                passed = false;
            }

            // Ê£ÄÊü•ÊØè‰∏™ÂàÜÁªÑÁöÑÂÜÖÂÆπ
            expectedGroups.forEach((expectedGroup, index) => {
                const actualGroup = actualGroups[index];

                if (!actualGroup) {
                    issues.push(`Áº∫Â∞ëÁ¨¨ ${index + 1} ‰∏™ÂàÜÁªÑ: ${expectedGroup.join(', ')}`);
                    passed = false;
                    return;
                }

                // Ê£ÄÊü•ÂàÜÁªÑÂÜÖÂÆπÊòØÂê¶ÂåπÈÖçÔºàÂøΩÁï•È°∫Â∫èÔºâ
                const expectedSet = new Set(expectedGroup);
                const actualSet = new Set(actualGroup);

                if (expectedSet.size !== actualSet.size) {
                    issues.push(`Á¨¨ ${index + 1} ÁªÑÂÖÉÁ¥†Êï∞Èáè‰∏çÂåπÈÖç: È¢ÑÊúü ${expectedGroup.join(', ')}, ÂÆûÈôÖ ${actualGroup.join(', ')}`);
                    passed = false;
                } else {
                    for (const item of expectedSet) {
                        if (!actualSet.has(item)) {
                            issues.push(`Á¨¨ ${index + 1} ÁªÑÁº∫Â∞ëÂÖÉÁ¥†: ${item}`);
                            passed = false;
                        }
                    }
                    for (const item of actualSet) {
                        if (!expectedSet.has(item)) {
                            issues.push(`Á¨¨ ${index + 1} ÁªÑÂ§ö‰ΩôÂÖÉÁ¥†: ${item}`);
                            passed = false;
                        }
                    }
                }
            });

            // ËæìÂá∫ÁªìÊûú
            if (passed) {
                const successMsg = `‚úÖ ${caseId}: ÂàÜÁªÑÈÄªËæëÊ≠£Á°Æ`;
                console.log(successMsg);
                globalErrorMessages.push(successMsg);
            } else {
                const errorMsg = `‚ùå ${caseId}: ÂàÜÁªÑÈÄªËæëÊúâÈóÆÈ¢ò`;
                console.log(errorMsg);
                globalErrorMessages.push(errorMsg);
                issues.forEach(issue => {
                    const issueMsg = `   - ${issue}`;
                    console.log(issueMsg);
                    globalErrorMessages.push(issueMsg);
                });
            }

            return passed;
        }

        // üéØ ÊòæÁ§∫ÈîôËØØ‰ø°ÊÅØÂà∞È°µÈù¢
        function displayErrorMessages() {
            const errorOutput = document.getElementById('error-output');
            if (globalErrorMessages.length > 0) {
                errorOutput.innerHTML = globalErrorMessages.join('\n');
                errorOutput.style.display = 'block';
            } else {
                errorOutput.style.display = 'none';
            }
        }

        // üéØ Â§çÂà∂ÈîôËØØ‰ø°ÊÅØÂà∞Ââ™Ë¥¥Êùø
        function copyErrorsToClipboard() {
            if (globalErrorMessages.length === 0) {
                alert('Ê≤°ÊúâÈîôËØØ‰ø°ÊÅØÂèØÂ§çÂà∂ÔºåËØ∑ÂÖàËøêË°åÊ†°È™å');
                return;
            }

            const errorText = globalErrorMessages.join('\n');

            // ‰ΩøÁî®Áé∞‰ª£ÁöÑ Clipboard API
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(errorText).then(() => {
                    alert('ÈîôËØØ‰ø°ÊÅØÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ');
                }).catch(err => {
                    console.error('Â§çÂà∂Â§±Ë¥•:', err);
                    fallbackCopyToClipboard(errorText);
                });
            } else {
                // ÈôçÁ∫ßÊñπÊ°à
                fallbackCopyToClipboard(errorText);
            }
        }

        // üéØ ÈôçÁ∫ßÂ§çÂà∂ÊñπÊ°à
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                document.execCommand('copy');
                alert('ÈîôËØØ‰ø°ÊÅØÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ');
            } catch (err) {
                console.error('Â§çÂà∂Â§±Ë¥•:', err);
                alert('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂È°µÈù¢‰∏äÊòæÁ§∫ÁöÑÈîôËØØ‰ø°ÊÅØ');
            }

            document.body.removeChild(textArea);
        }

        // üéØ ÊòæÁ§∫Ëá™Âä®ÊµãËØïÁªìÊûú
        function displayAutoTestResults() {
            const autoTestDiv = document.getElementById('auto-test-result');
            const testContent = document.getElementById('test-content');

            if (globalErrorMessages.length > 0) {
                // ÊèêÂèñÂÖ≥ÈîÆ‰ø°ÊÅØ
                const keyLines = globalErrorMessages.filter(line =>
                    line.includes('Ê†°È™åÁî®‰æã:') ||
                    line.includes('È¢ÑÊúüÂàÜÁªÑ') ||
                    line.includes('ÂÆûÈôÖÂàÜÁªÑ') ||
                    line.includes('ÂàÜÁªÑÈÄªËæëÊúâÈóÆÈ¢ò') ||
                    line.includes('ÂàÜÁªÑÈÄªËæëÊ≠£Á°Æ')
                );

                // Ê†ºÂºèÂåñÊòæÁ§∫
                let htmlContent = '';
                let currentCase = '';

                keyLines.forEach(line => {
                    if (line.includes('Ê†°È™åÁî®‰æã:')) {
                        currentCase = line.replace('üìã Ê†°È™åÁî®‰æã: ', '');
                        htmlContent += `<div style="margin: 10px 0; font-weight: bold; color: #0066cc;">${line}</div>`;
                    } else if (line.includes('È¢ÑÊúüÂàÜÁªÑ')) {
                        htmlContent += `<div style="margin: 5px 0; color: #28a745;">${line}</div>`;
                    } else if (line.includes('ÂÆûÈôÖÂàÜÁªÑ')) {
                        htmlContent += `<div style="margin: 5px 0; color: #dc3545;">${line}</div>`;
                    } else if (line.includes('ÂàÜÁªÑÈÄªËæë')) {
                        const isCorrect = line.includes('Ê≠£Á°Æ');
                        const color = isCorrect ? '#28a745' : '#dc3545';
                        const icon = isCorrect ? '‚úÖ' : '‚ùå';
                        htmlContent += `<div style="margin: 5px 0; color: ${color}; font-weight: bold;">${icon} ${line}</div>`;
                    }
                });

                testContent.innerHTML = htmlContent;
                autoTestDiv.style.display = 'block';

                // ÊªöÂä®Âà∞ÁªìÊûúÂå∫Âüü
                autoTestDiv.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // üéØ Ëá™Âä®ÊµãËØïÂíåÂàÜÊûêÂáΩÊï∞
        function runAutoTestAndAnalyze() {
            console.log('\nü§ñ ÂºÄÂßãËá™Âä®ÊµãËØïÂíåÂàÜÊûê...');

            // ËøêË°åÊâÄÊúâÊµãËØï
            validateAllCases();

            // ÂàÜÊûêÁªìÊûú
            const testResults = analyzeTestResults();

            // ËæìÂá∫ÂàÜÊûêÁªìÊûú
            console.log('\nüìä === ÊµãËØïÁªìÊûúÂàÜÊûê ===');
            console.log(`ÊÄªÈÄöËøáÁéá: ${testResults.passRate}%`);
            console.log(`Â§±Ë¥•Áî®‰æã: ${testResults.failedCases.join(', ')}`);

            // ËæìÂá∫ËØ¶ÁªÜÈîôËØØÂàÜÊûê
            testResults.failedCases.forEach(caseId => {
                const caseAnalysis = analyzeCaseErrors(caseId);
                console.log(`\nüîç ${caseId} ÈîôËØØÂàÜÊûê:`);
                console.log(`  ÈóÆÈ¢òÁ±ªÂûã: ${caseAnalysis.problemType}`);
                console.log(`  Âª∫ËÆÆ‰øÆÂ§ç: ${caseAnalysis.suggestion}`);
            });

            return testResults;
        }

        // üéØ ÂàÜÊûêÊµãËØïÁªìÊûú
        function analyzeTestResults() {
            const cases = ['simple_card', 'basic_layout', 'form_example', 'navigation_bar', 'dashboard_simple', 'figma_cs_enterprise'];
            const failedCases = [];
            let passedCount = 0;

            // ‰ªéÈîôËØØ‰ø°ÊÅØ‰∏≠ÊèêÂèñÂ§±Ë¥•ÁöÑÁî®‰æã
            globalErrorMessages.forEach(line => {
                if (line.includes('ÂàÜÁªÑÈÄªËæëÊúâÈóÆÈ¢ò')) {
                    const caseId = line.match(/(\w+):/)?.[1];
                    if (caseId && !failedCases.includes(caseId)) {
                        failedCases.push(caseId);
                    }
                } else if (line.includes('ÂàÜÁªÑÈÄªËæëÊ≠£Á°Æ')) {
                    passedCount++;
                }
            });

            return {
                totalCases: cases.length,
                passedCount: passedCount,
                failedCases: failedCases,
                passRate: Math.round((passedCount / cases.length) * 100)
            };
        }

        // üéØ ÂàÜÊûêÂçï‰∏™Áî®‰æãÁöÑÈîôËØØ
        function analyzeCaseErrors(caseId) {
            const caseMessages = globalErrorMessages.filter(line =>
                line.includes(caseId) ||
                (globalErrorMessages.indexOf(line) > globalErrorMessages.findIndex(l => l.includes(`Ê†°È™åÁî®‰æã: ${caseId}`)) &&
                 globalErrorMessages.indexOf(line) < globalErrorMessages.findIndex(l => l.includes('Ê†°È™åÁî®‰æã:') && l.indexOf(caseId) === -1))
            );

            let problemType = 'Êú™Áü•ÈóÆÈ¢ò';
            let suggestion = 'ÈúÄË¶ÅËøõ‰∏ÄÊ≠•ÂàÜÊûê';

            // ÂàÜÊûêÈóÆÈ¢òÁ±ªÂûã
            if (caseMessages.some(line => line.includes('ÂàÜÁªÑÊï∞Èáè‰∏çÂåπÈÖç'))) {
                const actualCount = caseMessages.find(line => line.includes('ÂÆûÈôÖÂàÜÁªÑ'))?.match(/(\d+) ÁªÑ/)?.[1];
                const expectedCount = caseMessages.find(line => line.includes('È¢ÑÊúüÂàÜÁªÑ'))?.match(/(\d+) ÁªÑ/)?.[1];

                if (actualCount && expectedCount) {
                    if (parseInt(actualCount) > parseInt(expectedCount)) {
                        problemType = 'ÂàÜÁªÑËøáÁªÜ';
                        suggestion = 'ÈúÄË¶ÅÊîæÂÆΩÂàÜÁªÑÊù°‰ª∂ÔºåËÆ©Êõ¥Â§öÂÖÉÁ¥†ÂêàÂπ∂Âà∞‰∏ÄÁªÑ';
                    } else {
                        problemType = 'ÂàÜÁªÑËøáÁ≤ó';
                        suggestion = 'ÈúÄË¶Å‰∏•Ê†ºÂàÜÁªÑÊù°‰ª∂ÔºåÈÅøÂÖç‰∏çÁõ∏ÂÖ≥ÂÖÉÁ¥†Ë¢´ÂàÜÂà∞‰∏ÄÁªÑ';
                    }
                }
            }

            return { problemType, suggestion };
        }

        // üéØ Â∞ùËØïËá™Âä®‰øÆÂ§ç
        function attemptAutoFix(testResults) {
            console.log(`\nüîß ÂàÜÊûê ${testResults.failedCases.length} ‰∏™Â§±Ë¥•Áî®‰æã...`);

            // ÁªüËÆ°ÈóÆÈ¢òÁ±ªÂûã
            const problemStats = {
                tooFine: 0,    // ÂàÜÁªÑËøáÁªÜ
                tooCoarse: 0,  // ÂàÜÁªÑËøáÁ≤ó
                mixed: 0       // Ê∑∑ÂêàÈóÆÈ¢ò
            };

            testResults.failedCases.forEach(caseId => {
                const analysis = analyzeCaseErrors(caseId);
                if (analysis.problemType === 'ÂàÜÁªÑËøáÁªÜ') {
                    problemStats.tooFine++;
                } else if (analysis.problemType === 'ÂàÜÁªÑËøáÁ≤ó') {
                    problemStats.tooCoarse++;
                } else {
                    problemStats.mixed++;
                }
            });

            console.log('ÈóÆÈ¢òÁªüËÆ°:', problemStats);

            // Ê†πÊçÆ‰∏ªË¶ÅÈóÆÈ¢òÁ±ªÂûãË∞ÉÊï¥ÁÆóÊ≥ï
            if (problemStats.tooFine > problemStats.tooCoarse) {
                console.log('üîß ‰∏ªË¶ÅÈóÆÈ¢òÔºöÂàÜÁªÑËøáÁªÜÔºåÈúÄË¶ÅÊîæÂÆΩÊù°‰ª∂');
                adjustGroupingForCoarser();
            } else if (problemStats.tooCoarse > problemStats.tooFine) {
                console.log('üîß ‰∏ªË¶ÅÈóÆÈ¢òÔºöÂàÜÁªÑËøáÁ≤óÔºåÈúÄË¶Å‰∏•Ê†ºÊù°‰ª∂');
                adjustGroupingForFiner();
            } else {
                console.log('üîß ÈóÆÈ¢òÁ±ªÂûãÊ∑∑ÂêàÔºåÈúÄË¶ÅÊõ¥Á≤æÁªÜÁöÑË∞ÉÊï¥');
                adjustGroupingMixed();
            }

            // ÈáçÊñ∞ÊµãËØï
            setTimeout(() => {
                console.log('\nüîÑ ÈáçÊñ∞ÊµãËØï‰øÆÂ§çÊïàÊûú...');
                runAutoTestAndAnalyze();
            }, 1000);
        }

        // üéØ Ë∞ÉÊï¥ÁÆóÊ≥ï‰ΩøÂàÜÁªÑÊõ¥Á≤óÁ≥ôÔºàÂêàÂπ∂Êõ¥Â§öÂÖÉÁ¥†Ôºâ
        function adjustGroupingForCoarser() {
            console.log('Ë∞ÉÊï¥Á≠ñÁï•ÔºöÊîæÂÆΩÊà™Êñ≠Ê£ÄÊµãÊù°‰ª∂');
            // ËøôÈáåÂèØ‰ª•Âä®ÊÄÅË∞ÉÊï¥ÁÆóÊ≥ïÂèÇÊï∞
            window.GROUPING_MODE = 'COARSER';
        }

        // üéØ Ë∞ÉÊï¥ÁÆóÊ≥ï‰ΩøÂàÜÁªÑÊõ¥Á≤æÁªÜÔºàÂàÜÁ¶ªÊõ¥Â§öÂÖÉÁ¥†Ôºâ
        function adjustGroupingForFiner() {
            console.log('Ë∞ÉÊï¥Á≠ñÁï•Ôºö‰∏•Ê†ºÊà™Êñ≠Ê£ÄÊµãÊù°‰ª∂');
            // ËøôÈáåÂèØ‰ª•Âä®ÊÄÅË∞ÉÊï¥ÁÆóÊ≥ïÂèÇÊï∞
            window.GROUPING_MODE = 'FINER';
        }

        // üéØ Ê∑∑ÂêàË∞ÉÊï¥Á≠ñÁï•
        function adjustGroupingMixed() {
            console.log('Ë∞ÉÊï¥Á≠ñÁï•Ôºö‰ΩøÁî®Ê∑∑ÂêàÊ®°Âºè');
            window.GROUPING_MODE = 'MIXED';
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
